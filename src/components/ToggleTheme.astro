---
// src/components/ToggleTheme.astro
---

<button 
  id="theme-toggle" 
  class="select-none cursor-pointer opacity-60 hover:opacity-100 transition-all duration-300 border-none bg-transparent p-0 flex items-center justify-center" 
  title="切换主题"
>
  <div class="i-ri-sun-line dark:hidden text-xl" />
  <div class="hidden dark:block i-ri-moon-line text-xl" />
</button>

<script>
  // 使用私有作用域，避免全局污染
  function initThemeToggle() {
    const btn = document.getElementById('theme-toggle');
    if (!btn) return;

    btn.addEventListener('click', () => {
      const html = document.documentElement;
      const isDark = html.classList.contains('dark');
      
      // 1. 切换类名
      html.classList.toggle('dark', !isDark);
      
      // 2. 记录状态
      const newTheme = !isDark ? 'dark' : 'light';
      localStorage.setItem('theme', newTheme);
      
      // 3. (可选) 如果你想要更高级的视图过渡效果（如圆形扩散），可以在这里写逻辑
    });
  }

  // 兼容 Astro 生命周期
  initThemeToggle();
  document.addEventListener('astro:after-swap', initThemeToggle);
</script>

<style>
  /* 增加一个小巧的旋转动画，让图标切换更有趣 */
  #theme-toggle:active {
    transform: scale(0.9) rotate(15deg);
  }
</style>