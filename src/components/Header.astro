---
import Logo from '../components/Logo.astro'
import ToggleTheme from './ToggleTheme.astro'
---

<header class="z-50">
  <!-- Logo 改为非 fixed -->
  <a 
    href="/" 
    class="absolute top-0 left-0 m-7 select-none outline-none z-60 hover:opacity-100 opacity-60 transition-opacity"
    aria-label="回到首页"
  >
    <Logo />
  </a>

  <!-- 导航栏保持非 fixed -->
  <nav class="absolute top-0 left-0 right-0 z-50 transition-all duration-500 pointer-events-none" id="main-nav">
    <div class="absolute inset-0 bg-mask opacity-0 transition-opacity duration-500 -z-1"></div>
    
    <div class="flex items-center justify-end gap-5 p-8 pointer-events-auto">
      <a href="/about" title="关于" class="opacity-60 md:hover:opacity-100 md:transition-opacity md:duration-200 text-sm font-medium no-underline select-none text-gray-700 dark:text-gray-200">
        <span class="lt-md:hidden">关于</span>
        <div class="i-ri:information-2-line md:hidden text-xl" />
      </a>
      <a href="https://github.com/antfu" target="_blank" rel="noopener noreferrer" title="GitHub" class="opacity-60 md:hover:opacity-100 md:transition-opacity md:duration-200 no-underline select-none text-gray-700 dark:text-gray-200">
        <div class="i-uil-github-alt text-xl" />
      </a>
      <ToggleTheme />
    </div>
  </nav>
</header>

<style>
  .bg-mask {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    mask-image: linear-gradient(to bottom, black 0%, black 50%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 0%, black 50%, transparent 100%);
    
    background: linear-gradient(
      to bottom, 
      rgba(255, 255, 255, 0.8) 0%, 
      rgba(255, 255, 255, 0) 100%
    );
  }

  :global(.dark) .bg-mask {
    background: linear-gradient(
      to bottom, 
      rgba(0, 0, 0, 0.7) 0%, 
      rgba(0, 0, 0, 0) 100%
    );
  }

  nav.scrolled .bg-mask {
    opacity: 1;
  }
</style>

<script>
  function initHeader() {
    const nav = document.getElementById('main-nav');
    if (!nav) return;
    const handleScroll = () => {
      if (window.scrollY > 20) {
        nav.classList.add('scrolled');
      } else {
        nav.classList.remove('scrolled');
      }
    };
    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll();
  }
  document.addEventListener('astro:page-load', initHeader);
</script>